/*!
 * auttarjs v0.3.3
 * (c) Heitor Ramon Ribeiro <heitor.ramon@gmail.com>
 * Released under the MIT License.
 */
!function(o,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(o=o||self).Auttar=a()}(this,function(){"use strict";function o(o,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}var a={Info:"info",Warn:"warn",Error:"error",Method:"method",All:"all",None:"none"},e={Info:"background:#215ace ; padding: 2px; border-radius: 2px 0 0 2px;  color: #fff;",Warn:"background:#e8c82c ; padding: 2px; border-radius: 2px 0 0 2px;  color: #000;",Error:"background:#c92112 ; padding: 2px; border-radius: 2px 0 0 2px;  color: #fff;",Method:"background:#6d0cb2 ; padding: 2px; border-radius: 2px 0 0 2px;  color: #fff;"},n="Auttar ",t="background:#bc0909 ; padding: 2px; border-radius: 0 2px 2px 0;  color: #fff ",r=function(o,a,e,n,t){console.log("%c ".concat(o," %c ").concat(e," %c ").concat(t),a,n,"background: transparent;")},c=function(o,a,e,n,t){console.error("%c ".concat(o," %c ").concat(e," %c ").concat(t),a,n,"background: transparent;")};function s(o){r(a.Info,e.Info,n,t,o)}function i(o){r(a.Warn,e.Warn,n,t,o)}function d(o,c,s){r(a.Method,e.Method,n,t,"Call Method: ".concat(o,"(").concat(c||"",") ").concat(s?"=> ".concat(JSON.stringify(s)):""))}function u(o){c(a.Warn,e.Warn,n,t,o)}var l={transactions:{credit:{base:112,installment:113,installmentWithInterest:114},debit:{base:101,voucher:106},cancel:128,confirm:6,requestCancel:191},return:{success:0,timeOut:1,notAuthorizes:5,internetError:10,intertefError:12,error:20,ecommerceError:30},errorCodes:{5300:"Valor não informado",5301:"Cartão inválido",5302:"Cartão vencido",5303:"Data de vencimento inválido",5304:"Código de segurança inválido",5305:"Taxa de serviço excede limite",5306:"Operação não permitida",5307:"Dados inválidos",5308:"Valor mínimo da parcela inválido",5309:"Número de parcelas inválido",5310:"Número de parcelas excede limite",5311:"Valor da entrada maior ou igual ao valor da transação",5312:"Valor da parcela inválido",5313:"Data inválida",5314:"Prazo excede limite",5316:"NSU inválido",5317:"Operação cancelada pelo usuário",5318:"Documento inválido (CPF ou CNPJ)",5319:"Valor do documento inválido",5328:"Erro na captura de dados do Pin-Pad",5329:"Erro na captura do chip ou cartão removido antes da hora.",5364:"Data de emissão do cartão inválida",5355:"O tipo de financiamento informado não é coerente com o número de parcelas"},ws:null,timeout:null,close:!0,timeoutConn:null,debug:!1};function g(){l.debug&&(d("_clearTimeout"),s("Clearing WebSocket timeout.")),l.close=!1,clearTimeout(l.timeoutConn)}function f(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;l.debug&&(d("_timeout","time",o),s("Starting WebSocket timeout.")),l.close=!0,l.timeoutConn=setTimeout(function(){l.close?l.ws.close():g()},o)}function m(o,a){return l.debug&&d("_connect","host",o),new Promise(function(e,n){try{null===l.ws?(l.debug&&s("Starting WebSocket Connection."),l.ws=new WebSocket(o)):2!==l.ws.readyState&&3!==l.ws.readyState||(l.debug&&i("WebSocket is connected but not available. Closing connection to start a new one."),l.debug&&d("_disconnect"),l.ws.close(),l.ws=new WebSocket(o))}catch(o){n(o)}if(l.ws){f();var t=function(){l.debug&&(s("Sending a message to the WebSocket."),s(JSON.stringify(a))),g(),l.ws.send(JSON.stringify(a)),f(6e4)};1===l.ws.readyState?t():l.ws.onopen=function(){l.debug&&s("WebSocket Connected."),t()},l.ws.onmessage=function(o){l.debug&&(s("Received a message from the WebSocket."),s(JSON.stringify(o.data))),g(),e(JSON.parse(o.data))},l.ws.onerror=function(o){l.debug&&(i("WebSocket has returned an error."),u(JSON.stringify(o))),g(),n(o)}}})}return function(){function a(o){!function(o,a){if(!(o instanceof a))throw new TypeError("Cannot call a class as a function")}(this,a),this.__host=o.host||"ws://localhost:2500",this.debug=o.debug||!1,l.debug=o.debug||!1,this.orderId=o.orderId||"",this.__amount=0,o.amount&&(this.amount=o.amount),this.__transactionDate=(new Date).toLocaleDateString("pt-BR",{year:"2-digit",month:"2-digit",day:"2-digit",timeZone:"America/Sao_Paulo"}).replace(/\//g,""),this.ctfTransaction={},this.__debugMessage=[]}var e,n,t;return e=a,(n=[{key:"debugLog",value:function(o){this.debug&&s(JSON.stringify(o))}},{key:"debugWarning",value:function(o){this.debug&&i(o)}},{key:"debugLogMethod",value:function(o,a){if(this.debug){for(var e=arguments.length,n=new Array(e>2?e-2:0),t=2;t<e;t++)n[t-2]=arguments[t];d(o,a,n)}}},{key:"classError",value:function(o){return this.debugMessage={message:o,logLevel:"error"},this.debug&&u(o),new Error(o)}},{key:"credit",value:function(){var o=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(n,t){o.debugLogMethod("credi","installments, withInterest",a,e);var r={valorTransacao:o.amount,documento:o.orderId,operacao:l.transactions.credit.base,dataTransacao:o.__transactionDate};a>1&&(r.operacao=l.transactions.credit.installment,r.numeroParcelas=a),a>1&&e&&(r.operacao=l.transactions.credit.installmentWithInterest,r.numeroParcelas=a),o.debugMessage={message:"Pagamento com cartão de crédito. Operação: ".concat(r.operacao,". Valor ").concat(o.amount," centavos")},m(o.__host,r).then(function(a){if(a.retorno>0){var e=l.errorCodes[a.codigoErro]||a.display.length?a.display.map(function(o){return o.mensagem}).join(" "):" ";t(o.classError("Transação não concluída ".concat(a.codigoErro,": ").concat(e)))}o.ctfTransaction=Object.assign({},a,{dataTransacao:o.__transactionDate}),o.debugMessage={message:o.ctfTransaction},n(a)}).catch(function(a){return o.classError(a)})})}},{key:"debit",value:function(){var o=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(e,n){o.debugLogMethod("debit","isVoucher",a);var t=a?l.transactions.debit.voucher:l.transactions.debit.base;o.debugMessage={message:"Pagamento com cartão de débito. Operação: ".concat(t,". Valor ").concat(o.amount," centavos")},m(o.__host,{valorTransacao:o.amount,documento:o.orderId,dataTransacao:o.__transactionDate,operacao:t}).then(function(a){if(a.retorno>0){var t=l.errorCodes[a.codigoErro]||a.display.length?a.display.map(function(o){return o.mensagem}).join(" "):" ";n(o.classError("Transação não concluída ".concat(a.codigoErro,": ").concat(t)))}o.ctfTransaction=Object.assign({},a,{dataTransacao:o.__transactionDate}),o.debugMessage={message:o.ctfTransaction},e(a)}).catch(function(a){return o.classError(a)})})}},{key:"confirm",value:function(){var o=this;return new Promise(function(a,e){o.debugLogMethod("confirm");var n=l.transactions.confirm;m(o.__host,{operacao:n}).then(function(n){if(o.debugMessage={message:"Confirmação de pagamento da operação realizada.\n      Operação: ".concat(o.ctfTransaction.operacao,"\n      Data: ").concat(o.ctfTransaction.dataTransacao,"\n      Valor: ").concat(o.amount,"\n      Bandeira: ").concat(o.ctfTransaction.bandeira,"\n      Cartão: ").concat(o.ctfTransaction.cartao)},n.retorno>0){var t=l.errorCodes[n.codigoErro]||n.display.length?n.display.map(function(o){return o.mensagem}).join(" "):" ";e(o.classError("Transação não concluída ".concat(n.codigoErro,": ").concat(t)))}o.ctfTransaction=Object.assign(o.ctfTransaction,n),o.debugMessage={message:o.ctfTransaction},a(n)}).catch(function(a){return o.classError(a)})})}},{key:"requestCancellation",value:function(){var o=this;return new Promise(function(a,e){o.debugLogMethod("requestCancellation");var n=l.transactions.requestCancel;m(o.__host,{operacao:n}).then(function(n){if(o.debugMessage={message:"Requisição de cancelamento de compra.\n      Operação: ".concat(o.ctfTransaction.operacao,"\n      Data: ").concat(o.ctfTransaction.dataTransacao,"\n      Valor: ").concat(o.amount,"\n      NSU: ").concat(o.ctfTransaction.nsuCTF)},n.retorno>0){var t=l.errorCodes[n.codigoErro]||n.display.length?n.display.map(function(o){return o.mensagem}).join(" "):" ";e(o.classError("Transação não concluída ".concat(n.codigoErro,": ").concat(t)))}o.debugMessage={message:n},a(n)}).catch(function(a){return o.classError(a)})})}},{key:"cancel",value:function(){var o=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,n){o.debugLogMethod("cancel","prop",a);var t=l.transactions.cancel,r=a.operacao||o.ctfTransaction.operacao,c=a.dataTransacao||o.ctfTransaction.dataTransacao,s=a.amount?100*parseFloat(a.amount):o.ctfTransaction.valorTransacao,i=a.nsuCTF||o.ctfTransaction.nsuCTF;m(o.__host,{operacao:t,valorTransacao:s,dataTransacao:c,nsuCTF:i}).then(function(a){if(o.debugMessage={message:"Cancelamento de compra.\n        Operação: ".concat(r,"\n        Data: ").concat(c,"\n        Valor: ").concat(s,"\n        NSU: ").concat(i)},a.retorno>0){var t=l.errorCodes[a.codigoErro]||a.display[0].mensagem;n(o.classError("Transação não concluída ".concat(a.codigoErro,": ").concat(t)))}o.debugMessage={message:a},e(a)}).catch(function(a){return o.classError(a)})})}},{key:"debugMessage",get:function(){return this.__debugMessage},set:function(o){if(this.debug){var a=Object.assign({logLevel:"info",message:""},o);return"log"===a.logLevel&&a.message?this.debugLog(a.message):(this.__debugMessage.push(Object.assign({},a,{date:(new Date).toISOString()})),this.debugLog(a.message))}}},{key:"amount",get:function(){return this.__amount},set:function(o){if("number"==typeof o&&o<=0)throw new Error("Não é possível definir um valor menor ou igual a zero.");this.__amount=100*parseFloat(o)}}])&&o(e.prototype,n),t&&o(e,t),a}()});
//# sourceMappingURL=index.umd.js.map
