/*!
 * auttarjs v0.1.8
 * (c) Heitor Ramon Ribeiro <heitor.ramon@gmail.com>
 * Released under the MIT License.
 */
!function(a,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(a=a||self).Auttar=e()}(this,function(){"use strict";function a(a,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}var e="%c Auttar ",o="background:#bc0909 ; padding: 2px; border-radius: 2px;  color: #fff ";var n={transactions:{credit:{base:112,installment:113,installmentWithInterest:114},debit:{base:101,voucher:106},cancel:128,confirm:6,requestCancel:191},return:{success:0,timeOut:1,notAuthorizes:5,internetError:10,intertefError:12,error:20,ecommerceError:30},errorCodes:{5300:"Valor não informado",5301:"Cartão inválido",5302:"Cartão vencido",5303:"Data de vencimento inválido",5304:"Código de segurança inválido",5305:"Taxa de serviço excede limite",5306:"Operação não permitida",5307:"Dados inválidos",5308:"Valor mínimo da parcela inválido",5309:"Número de parcelas inválido",5310:"Número de parcelas excede limite",5311:"Valor da entrada maior ou igual ao valor da transação",5312:"Valor da parcela inválido",5313:"Data inválida",5314:"Prazo excede limite",5316:"NSU inválido",5317:"Operação cancelada pelo usuário",5318:"Documento inválido (CPF ou CNPJ)",5319:"Valor do documento inválido",5328:"Erro na captura de dados do Pin-Pad",5329:"Erro na captura do chip ou cartão removido antes da hora.",5364:"Data de emissão do cartão inválida",5355:"O tipo de financiamento informado não é coerente com o número de parcelas"},ws:null,timeout:null,close:!0,timeoutConn:null,firstCall:!0};function t(){n.close=!1,clearTimeout(n.timeoutConn)}function r(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;n.close=!0,n.timeoutConn=setTimeout(function(){n.close?n.ws.close():t()},a)}function s(a,e){return new Promise(function(o,s){try{null===n.ws?n.ws=new WebSocket(a):2!==n.ws.readyState&&3!==n.ws.readyState||(n.ws.close(),n.ws=new WebSocket(a))}catch(a){s(a)}n.ws&&(r(),n.firstCall?(n.firstCall=!1,n.ws.onopen=function(){t(),n.ws.send(JSON.stringify(e)),r(6e4)}):n.ws.send(JSON.stringify(e)),n.ws.onmessage=function(a){t(),o(JSON.parse(a.data))},n.ws.onerror=function(a){t(),s(a)})})}return function(){function t(a){!function(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.__host=a.host||"ws://localhost:2500",this.debug=a.debug||!1,this.orderId=a.orderId||"",this.__amount=0,a.amount&&(this.amount=a.amount),this.__transactionDate=(new Date).toLocaleDateString("pt-BR",{year:"2-digit",month:"2-digit",day:"2-digit",timeZone:"America/Sao_Paulo"}).replace(/\//g,""),this.ctfTransaction={},this.__debugMessage=[]}var r,c,i,d;return r=t,(c=[{key:"debugLog",value:function(a){var n;this.debug&&(n=a,console.log(e,o,n))}},{key:"classError",value:function(a){return this.debugMessage={message:a,logLevel:"error"},new Error(a)}},{key:"credit",value:function(){var a=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(t,r){var c={valorTransacao:a.amount,documento:a.orderId,operacao:n.transactions.credit.base,dataTransacao:a.__transactionDate};e>1&&(c.operacao=n.transactions.credit.installment,c.numeroParcelas=e),e>1&&o&&(c.operacao=n.transactions.credit.installmentWithInterest,c.numeroParcelas=e),a.debugMessage={message:"Pagamento com cartão de crédito. Operação: ".concat(c.operacao,". Valor ").concat(a.amount," centavos")},s(a.__host,c).then(function(e){if(e.retorno>0){var o=n.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(a){return a.mensagem}).join(" "):" ",s=a.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(o));r(s)}a.ctfTransaction=Object.assign({},e,{dataTransacao:a.__transactionDate}),a.debugMessage={message:"Resposta do servidor -> ".concat(JSON.stringify(e)),logLevel:"log"},a.debugMessage={message:a.ctfTransaction,logLevel:"json"},t(e)}).catch(function(e){return a.classError(e)})})}},{key:"debit",value:function(){var a=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(o,t){var r=e?n.transactions.debit.voucher:n.transactions.debit.base;a.debugMessage={message:"Pagamento com cartão de débito. Operação: ".concat(r,". Valor ").concat(a.amount," centavos")},s(a.__host,{valorTransacao:a.amount,documento:a.orderId,dataTransacao:a.__transactionDate,operacao:r}).then(function(e){if(e.retorno>0){var r=n.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(a){return a.mensagem}).join(" "):" ",s=a.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(r));t(s)}a.ctfTransaction=Object.assign({},e,{dataTransacao:a.__transactionDate}),a.debugMessage={message:"Resposta do servidor -> ".concat(JSON.stringify(e)),logLevel:"log"},a.debugMessage={message:a.ctfTransaction,logLevel:"json"},o(e)}).catch(function(e){return a.classError(e)})})}},{key:"confirm",value:(d=function(){var a=this;return function(a,e){try{var o=a()}catch(a){return e(a)}return o&&o.then?o.then(void 0,e):o}(function(){var e,o,t,r=n.transactions.confirm;return e=s(a.__host,{operacao:r}),o=function(e){if(a.debugMessage={message:"Confirmação de pagamento da operação realizada.\n      Operação: ".concat(a.ctfTransaction.operacao,"\n      Data: ").concat(a.ctfTransaction.dataTransacao,"\n      Valor: ").concat(a.amount,"\n      Bandeira: ").concat(a.ctfTransaction.bandeira,"\n      Cartão: ").concat(a.ctfTransaction.cartao)},e.retorno>0){var o=n.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(a){return a.mensagem}).join(" "):" ",t=a.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(o));reject(t)}return a.ctfTransaction=Object.assign(a.ctfTransaction,e),a.debugMessage={message:"Resposta do servidor -> ".concat(JSON.stringify(e)),logLevel:"log"},a.debugMessage={message:e,logLevel:"json"},Promise.resolve(e)},t?o?o(e):e:(e&&e.then||(e=Promise.resolve(e)),o?e.then(o):e)},function(e){a.classError(e)})},function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];try{return Promise.resolve(d.apply(this,a))}catch(a){return Promise.reject(a)}})},{key:"requestCancellation",value:function(){var a=this;return new Promise(function(e,o){var t=n.transactions.requestCancel;a.debugMessage={message:"Requisição de cancelamento de compra.\n      Operação: ".concat(a.ctfTransaction.operacao,"\n      Data: ").concat(a.ctfTransaction.dataTransacao,"\n      Valor: ").concat(a.amount,"\n      NSU: ").concat(a.ctfTransaction.nsuCTF)},s(a.__host,{operacao:t}).then(function(t){if(t.retorno>0){var r=n.errorCodes[t.codigoErro]||t.display.length?t.display.map(function(a){return a.mensagem}).join(" "):" ",s=a.classError("Transação não concluída ".concat(t.codigoErro,": ").concat(r));o(s)}a.debugMessage={message:"Resposta do servidor -> ".concat(JSON.stringify(t)),logLevel:"log"},a.debugMessage={message:responsea,logLevel:"json"},e(t)}).catch(function(e){return a.classError(e)})})}},{key:"cancel",value:function(){var a=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(o,t){var r=n.transactions.cancel,c=e.operacao||a.ctfTransaction.operacao,i=e.dataTransacao||a.ctfTransaction.dataTransacao,d=e.amount?100*parseFloat(e.amount):a.ctfTransaction.valorTransacao,u=e.nsuCTF||a.ctfTransaction.nsuCTF;a.debugMessage={message:"Cancelamento de compra.\n        Operação: ".concat(c,"\n        Data: ").concat(i,"\n        Valor: ").concat(d,"\n        NSU: ").concat(u)},s(a.__host,{operacao:r,valorTransacao:d,dataTransacao:i,nsuCTF:u}).then(function(e){if(e.retorno>0){var r=n.errorCodes[e.codigoErro]||e.display[0].mensagem,s=a.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(r));t(s)}a.debugMessage={message:"Resposta do servidor -> ".concat(JSON.stringify(e)),logLevel:"log"},a.debugMessage={message:e,logLevel:"json"},o(e)}).catch(function(e){return a.classError(e)})})}},{key:"debugMessage",get:function(){return this.__debugMessage},set:function(a){if(this.debug){var e=Object.assign({logLevel:"info",message:""},a,{date:(new Date).toISOString()});if("log"===e.logLevel&&e.message)return this.debugLog(e.message);this.__debugMessage.push(Object.assign({},e,{date:(new Date).toISOString()})),"info"===e.logLevel&&e.message&&this.debugLog(e.message)}}},{key:"amount",get:function(){return this.__amount},set:function(a){if("number"==typeof a&&a<=0)throw new Error("Não é possível definir um valor menor ou igual a zero.");this.__amount=100*parseFloat(a)}}])&&a(r.prototype,c),i&&a(r,i),t}()});
//# sourceMappingURL=index.umd.js.map
