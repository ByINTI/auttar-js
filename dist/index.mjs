/*!
 * auttarjs v0.3.1
 * (c) Heitor Ramon Ribeiro <heitor.ramon@gmail.com>
 * Released under the MIT License.
 */
function o(o,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}var e={Info:"info",Warn:"warn",Error:"error",Method:"method",All:"all",None:"none"},a={Info:"background:#215ace ; padding: 2px; border-radius: 2px 0 0 2px;  color: #fff;",Warn:"background:#e8c82c ; padding: 2px; border-radius: 2px 0 0 2px;  color: #000;",Error:"background:#c92112 ; padding: 2px; border-radius: 2px 0 0 2px;  color: #fff;",Method:"background:#6d0cb2 ; padding: 2px; border-radius: 2px 0 0 2px;  color: #fff;"},n="Auttar ",r="background:#bc0909 ; padding: 2px; border-radius: 0 2px 2px 0;  color: #fff ",t=function(o,e,a,n,r){console.log("%c ".concat(o," %c ").concat(a," %c ").concat(r),e,n,"background: transparent;")},c=function(o,e,a,n,r){console.error("%c ".concat(o," %c ").concat(a," %c ").concat(r),e,n,"background: transparent;")};function i(o){t(e.Info,a.Info,n,r,o)}function s(o){t(e.Warn,a.Warn,n,r,o)}function u(o,c,i){t(e.Method,a.Method,n,r,"Call Method: ".concat(o,"(").concat(c||"",") ").concat(i?"=> ".concat(JSON.stringify(i)):""))}function d(o){c(e.Warn,a.Warn,n,r,o)}function l(o){return function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];try{return Promise.resolve(o.apply(this,e))}catch(o){return Promise.reject(o)}}}function g(o,e){try{var a=o()}catch(o){return e(o)}return a&&a.then?a.then(void 0,e):a}function f(o,e,a){return a?e?e(o):o:(o&&o.then||(o=Promise.resolve(o)),e?o.then(e):o)}var m={transactions:{credit:{base:112,installment:113,installmentWithInterest:114},debit:{base:101,voucher:106},cancel:128,confirm:6,requestCancel:191},return:{success:0,timeOut:1,notAuthorizes:5,internetError:10,intertefError:12,error:20,ecommerceError:30},errorCodes:{5300:"Valor não informado",5301:"Cartão inválido",5302:"Cartão vencido",5303:"Data de vencimento inválido",5304:"Código de segurança inválido",5305:"Taxa de serviço excede limite",5306:"Operação não permitida",5307:"Dados inválidos",5308:"Valor mínimo da parcela inválido",5309:"Número de parcelas inválido",5310:"Número de parcelas excede limite",5311:"Valor da entrada maior ou igual ao valor da transação",5312:"Valor da parcela inválido",5313:"Data inválida",5314:"Prazo excede limite",5316:"NSU inválido",5317:"Operação cancelada pelo usuário",5318:"Documento inválido (CPF ou CNPJ)",5319:"Valor do documento inválido",5328:"Erro na captura de dados do Pin-Pad",5329:"Erro na captura do chip ou cartão removido antes da hora.",5364:"Data de emissão do cartão inválida",5355:"O tipo de financiamento informado não é coerente com o número de parcelas"},ws:null,timeout:null,close:!0,timeoutConn:null,host:"",debug:!1};function b(o,e){return m.debug&&u("_webSocket","host",o),null===m.ws?(m.debug&&i("Starting WebSocket Connection."),m.ws=new WebSocket(o)):2!==m.ws.readyState&&3!==m.ws.readyState||(m.debug&&s("WebSocket is connected but not available. Closing connection to start a new one."),m.debug&&u("_disconnect"),m.ws.close(),m.debug&&i("WebSocket Disconnected"),m.ws=new WebSocket(o)),new Promise(function(o,a){try{h();var n=function(){m.debug&&(i("Sending a message to the WebSocket."),i(JSON.stringify(e))),p(),m.ws.send(JSON.stringify(e)),h(6e4)};0===m.ws.readyState?m.ws.onopen=function(){m.debug&&i("WebSocket Connected."),n()}:1===m.ws.readyState&&n(),m.ws.onmessage=function(e){i("Received a message from the WebSocket."),p(),o(JSON.parse(e.data))},m.ws.onerror=function(o){m.debug&&(s("WebSocket has returned an error."),d(o)),p(),o&&a(o)}}catch(o){m.debug&&(s("WebSocket has returned an error."),d(o)),a(o)}})}function p(){m.close=!1,clearTimeout(m.timeoutConn)}function h(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;m.close=!0,m.timeoutConn=setTimeout(function(){m.close?m.ws.close():p()},o)}export default(function(){function e(o){!function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.__host=o.host||"ws://localhost:2500",this.debug=o.debug||!1,m.debug=o.debug||!1,this.orderId=o.orderId||"",this.__amount=0,o.amount&&(this.amount=o.amount),this.__transactionDate=(new Date).toLocaleDateString("pt-BR",{year:"2-digit",month:"2-digit",day:"2-digit",timeZone:"America/Sao_Paulo"}).replace(/\//g,""),this.ctfTransaction={},this.__debugMessage=[],b(this.__host)}var a,n,r;return a=e,(n=[{key:"debugLog",value:function(o){this.debug&&i(o)}},{key:"debugWarning",value:function(o){this.debug&&s(o)}},{key:"debugLogMethod",value:function(o,e){if(this.debug){for(var a=arguments.length,n=new Array(a>2?a-2:0),r=2;r<a;r++)n[r-2]=arguments[r];u(o,e,n)}}},{key:"classError",value:function(o){return this.debugMessage={message:o,logLevel:"error"},this.debug&&d(o),new Error(o)}},{key:"credit",value:l(function(){var o=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o.debugLogMethod("credi","installments, withInterest",e,a),g(function(){var n={valorTransacao:o.amount,documento:o.orderId,operacao:m.transactions.credit.base,dataTransacao:o.__transactionDate};return e>1&&(n.operacao=m.transactions.credit.installment,n.numeroParcelas=e),e>1&&a&&(n.operacao=m.transactions.credit.installmentWithInterest,n.numeroParcelas=e),o.debugMessage={message:"Pagamento com cartão de crédito. Operação: ".concat(n.operacao,". Valor ").concat(o.amount," centavos")},f(b(o.__host,n),function(e){if(e.retorno>0){var a=m.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(o){return o.mensagem}).join(" "):" ";return Promise.reject(o.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(a)))}return o.ctfTransaction=Object.assign({},e,{dataTransacao:o.__transactionDate}),Promise.resolve(e)})},function(o){return Promise.reject(o)})})},{key:"debit",value:l(function(){var o=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return g(function(){o.debugLogMethod("debit","isVoucher",e),o.debugMessage={message:"Pagamento com cartão de débito. Operação: ".concat(operacao,". Valor ").concat(o.amount," centavos")};var a={valorTransacao:o.amount,documento:o.orderId,dataTransacao:o.__transactionDate,operacao:e?m.transactions.debit.voucher:m.transactions.debit.base};return f(b(o.__host,a),function(e){if(e.retorno>0){var a=m.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(o){return o.mensagem}).join(" "):" ";return Promise.reject(o.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(a)))}return o.ctfTransaction=Object.assign({},e,{dataTransacao:o.__transactionDate}),Promise.resolve(e)})},function(o){return Promise.reject(o)})})},{key:"confirm",value:l(function(){var o=this;return g(function(){return o.debugLogMethod("confirm"),f(b(o.__host,{operacao:m.transactions.confirm}),function(e){if(o.debugMessage={message:"Confirmação de pagamento da operação realizada.\n      Operação: ".concat(o.ctfTransaction.operacao,"\n      Data: ").concat(o.ctfTransaction.dataTransacao,"\n      Valor: ").concat(o.amount,"\n      Bandeira: ").concat(o.ctfTransaction.bandeira,"\n      Cartão: ").concat(o.ctfTransaction.cartao)},e.retorno>0){var a=m.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(o){return o.mensagem}).join(" "):" ";return Promise.reject(o.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(a)))}return o.ctfTransaction=Object.assign(o.ctfTransaction,e),Promise.resolve(e)})},function(o){return Promise.reject(o)})})},{key:"requestCancellation",value:l(function(){var o=this;return g(function(){return o.debugLogMethod("requestCancellation"),o.debugMessage={message:"Requisição de cancelamento de compra.\n      Operação: ".concat(o.ctfTransaction.operacao,"\n      Data: ").concat(o.ctfTransaction.dataTransacao,"\n      Valor: ").concat(o.amount,"\n      NSU: ").concat(o.ctfTransaction.nsuCTF)},f(b(o.__host,{operacao:m.transactions.requestCancel}),function(e){if(e.retorno>0){var a=m.errorCodes[e.codigoErro]||e.display.length?e.display.map(function(o){return o.mensagem}).join(" "):" ";return Promise.reject(o.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(a)))}return Promise.resolve(e)})},function(o){return Promise.reject(o)})})},{key:"cancel",value:l(function(){var o=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g(function(){o.debugLogMethod("cancel","prop",e);var a=m.transactions.cancel,n=e.operacao||o.ctfTransaction.operacao,r=e.dataTransacao||o.ctfTransaction.dataTransacao,t=e.amount?100*parseFloat(e.amount):o.ctfTransaction.valorTransacao,c=e.nsuCTF||o.ctfTransaction.nsuCTF;return o.debugMessage={message:"Cancelamento de compra.\n        Operação: ".concat(n,"\n        Data: ").concat(r,"\n        Valor: ").concat(t,"\n        NSU: ").concat(c)},f(b(o.__host,{operacao:a,valorTransacao:t,dataTransacao:r,nsuCTF:c}),function(e){if(e.retorno>0){var a=m.errorCodes[e.codigoErro]||e.display[0].mensagem;return Promise.reject(o.classError("Transação não concluída ".concat(e.codigoErro,": ").concat(a)))}})},function(o){return Promise.reject(o)})})},{key:"debugMessage",get:function(){return this.__debugMessage},set:function(o){if(this.debug){var e=Object.assign({logLevel:"info",message:""},o,{date:(new Date).toISOString()});if("log"===e.logLevel&&e.message)return this.debugLog(e.message);this.__debugMessage.push(Object.assign({},e,{date:(new Date).toISOString()})),"info"===e.logLevel&&e.message&&this.debugLog(e.message)}}},{key:"amount",get:function(){return this.__amount},set:function(o){if("number"==typeof o&&o<=0)throw new Error("Não é possível definir um valor menor ou igual a zero.");this.__amount=100*parseFloat(o)}}])&&o(a.prototype,n),r&&o(a,r),e}());
//# sourceMappingURL=index.mjs.map
